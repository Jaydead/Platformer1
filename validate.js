const TILE_SOLID = {1:true, 2:true, 3:true, 8:true};

function analyzeLevel(name, rows, entities) {
    console.log('\n=== ' + name + ' ===');

    // Check row lengths
    for (var r = 0; r < rows.length; r++) {
        if (rows[r].length !== 60) console.log('  BAD ROW LENGTH: row ' + r + ' len=' + rows[r].length);
    }

    // Find all spike runs (tile 4)
    for (var r = 0; r < rows.length; r++) {
        var inSpike = false;
        var start = -1;
        for (var c = 0; c <= rows[r].length; c++) {
            var ch = rows[r][c];
            if (ch === '4' && !inSpike) { inSpike = true; start = c; }
            if (ch !== '4' && inSpike) {
                var width = c - start;
                if (width > 2) console.log('  SPIKES TOO WIDE: row ' + r + ' cols ' + start + '-' + (c-1) + ' width=' + width);
                inSpike = false;
            }
        }
    }

    // Find doors
    for (var r = 0; r < rows.length; r++) {
        for (var c = 0; c < rows[r].length; c++) {
            if (rows[r][c] === '6' || rows[r][c] === '7') {
                console.log('  Door tile ' + rows[r][c] + ' at (' + c + ',' + r + ')');
            }
        }
    }

    // Check entities
    var ok = true;
    entities.forEach(function(e) {
        var tile = rows[e.y] ? Number(rows[e.y][e.x]) : -1;
        var below = rows[e.y + 1] ? Number(rows[e.y + 1][e.x]) : -1;
        var issues = [];
        if (TILE_SOLID[tile]) issues.push('INSIDE SOLID tile=' + tile);
        if (tile === 4) issues.push('IN SPIKES');
        if (tile === -1) issues.push('OUT OF BOUNDS');
        if ((e.type === 'slime' || e.type === 'player' || e.type === 'boss') && !TILE_SOLID[below]) {
            issues.push('NO GROUND below=' + below);
        }
        if (issues.length) {
            console.log('  ' + e.type + ' (' + e.x + ',' + e.y + '): ' + issues.join(', '));
            ok = false;
        }
    });
    if (ok) console.log('  All entity checks passed!');

    // End section - show cols 44-59 for path verification
    console.log('  End section (cols 44-59):');
    for (var r = 0; r < rows.length; r++) {
        console.log('    r' + (r < 10 ? ' ' : '') + r + ': ' + rows[r].substring(44));
    }
}

analyzeLevel('LEVEL 1', [
    '000000000000000000000000000000000000000000000000000000000000',
    '000000000000000000000000000000000000000000000000000000000000',
    '000000000000000000000000000000000000000000000000000067000000',
    '000000000000000000000000000000000000000000000000001117000000',
    '000000000000000000000000000000000000000000000055501112000000',
    '000000000000000000000000000000000000000000000000001112000000',
    '000000000000000000000000000000000005550000055555501112000000',
    '000000000000000000000000000000000000000000000000001112000000',
    '000000000000000000000555000000000000000005550055501112000000',
    '000000000000000000000000000005550000000000000000001112000000',
    '000000000000055500000000000000000000000000000055501112000000',
    '000000000000000000000000000000000000040000000000001112000000',
    '000000000000000000000000001110000000000000000055501112000000',
    '000000000000000000000000000000000001110000044000001112000000',
    '000000000000000000000011100000011000000011111111111112000000',
    '111111111111111111111111211111111111111112222222222222000000',
    '222222222222222222222222222222222222222222222222222222000000',
], [
    { type: 'player', x: 2, y: 14 },
    { type: 'coin', x: 8, y: 14 },
    { type: 'coin', x: 10, y: 14 },
    { type: 'coin', x: 14, y: 9 },
    { type: 'coin', x: 22, y: 7 },
    { type: 'coin', x: 24, y: 7 },
    { type: 'coin', x: 30, y: 8 },
    { type: 'coin', x: 36, y: 5 },
    { type: 'coin', x: 37, y: 5 },
    { type: 'coin', x: 42, y: 7 },
    { type: 'coin', x: 47, y: 3 },
    { type: 'coin', x: 48, y: 3 },
    { type: 'heart', x: 43, y: 7 },
    { type: 'key', x: 52, y: 1 },
    { type: 'slime', x: 16, y: 14 },
    { type: 'slime', x: 30, y: 14 },
    { type: 'slime', x: 37, y: 14 },
]);

analyzeLevel('LEVEL 2', [
    '333333333333333333333333333333333333333333333333333333333333',
    '300000000000000000000000000000000000000000000000000000000033',
    '300000000000000000000000000000000000000000000000000006700033',
    '300000000000000000000000000000000000000000000000000011700033',
    '300000000000000000000000000000000000000000000005550111200033',
    '300000000000000000000000000000000000000000000000001111200033',
    '300000000000000000000000000000000000055000005550001111200033',
    '300000000000000000005550000000000000000000000000001111200033',
    '300000000000000000000000000005500000000005550005551111200033',
    '300000000000555000000000000000000000000000000000001111200033',
    '300000000000000000000000003110000000000000000005551111200033',
    '300000000000000000000000000000000000000000000000001111200033',
    '300000005500000000000000000000005500000000000005551111200033',
    '300000000000000000004400000000000000004400000000001111200033',
    '300000000000000033311330000011100331133000011100001111200033',
    '311111111331111133311113333111133311113333111133311111200033',
    '322222222332222233322223333222233322223333222233322222200033',
], [
    { type: 'player', x: 2, y: 14 },
    { type: 'coin', x: 6, y: 14 },
    { type: 'coin', x: 8, y: 14 },
    { type: 'coin', x: 12, y: 8 },
    { type: 'coin', x: 22, y: 6 },
    { type: 'coin', x: 23, y: 6 },
    { type: 'coin', x: 30, y: 7 },
    { type: 'coin', x: 38, y: 7 },
    { type: 'coin', x: 39, y: 7 },
    { type: 'coin', x: 43, y: 5 },
    { type: 'coin', x: 49, y: 3 },
    { type: 'coin', x: 50, y: 3 },
    { type: 'heart', x: 10, y: 11 },
    { type: 'key', x: 53, y: 1 },
    { type: 'slime', x: 15, y: 14 },
    { type: 'slime', x: 25, y: 14 },
    { type: 'slime', x: 41, y: 14 },
    { type: 'bat', x: 20, y: 5 },
    { type: 'bat', x: 35, y: 4 },
    { type: 'bat', x: 48, y: 3 },
]);

analyzeLevel('LEVEL 3', [
    '888888888888888888888888888888888888888888888888888888888888',
    '800000000000000000000000000000000000000000000000000000000088',
    '800000000000000000000000000000000000000000000000000067000088',
    '800000000000000000000000000000000000000000000000001117000088',
    '800000000000000000000000000000000000000000000555011120000088',
    '800000000000000000000000000000000000000000000000011120000088',
    '800000000000000000000000000000000005500005550555011120000088',
    '800000000000000000000000000000000000000000000000011120000088',
    '800000000000000000005500000055000000000555000555011120000088',
    '800000000000000000000000000000008800000000000000011120000088',
    '800000000000000000000000000000000000000000000555011120000088',
    '800000000000005500000000004400000000000000000000011120000088',
    '800000005500000000000000088800000055000000000555011120000088',
    '800000000000000000044000000000000000000000044000011120000088',
    '800000000000000088111880008800000011100088800000011120000088',
    '811111111881111188111118888118888111111888111888811120000088',
    '822222222882222288222228888228888222222888222888822220000088',
], [
    { type: 'player', x: 2, y: 14 },
    { type: 'coin', x: 6, y: 14 },
    { type: 'coin', x: 8, y: 14 },
    { type: 'coin', x: 14, y: 10 },
    { type: 'coin', x: 21, y: 7 },
    { type: 'coin', x: 27, y: 7 },
    { type: 'coin', x: 36, y: 5 },
    { type: 'coin', x: 37, y: 5 },
    { type: 'coin', x: 42, y: 7 },
    { type: 'coin', x: 47, y: 2 },
    { type: 'coin', x: 48, y: 2 },
    { type: 'heart', x: 15, y: 10 },
    { type: 'heart', x: 37, y: 7 },
    { type: 'key', x: 53, y: 1 },
    { type: 'slime', x: 15, y: 14 },
    { type: 'slime', x: 32, y: 14 },
    { type: 'bat', x: 10, y: 5 },
    { type: 'bat', x: 25, y: 4 },
    { type: 'bat', x: 40, y: 3 },
    { type: 'bat', x: 47, y: 1 },
    { type: 'boss', x: 38, y: 14 },
]);
